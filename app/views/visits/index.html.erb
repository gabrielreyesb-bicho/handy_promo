<%# Barra de información / navegación (componente reutilizable) %>
<%= render 'shared/view_header', title: "Visitas Programadas" do %>
  <%= link_to new_visit_path, class: "btn btn-primary" do %>
    <i class="bi bi-plus-circle me-2"></i> Programar Visita
  <% end %>
<% end %>

<%# Espacio vacío (componente reutilizable) %>
<div class="view-spacing"></div>

<%# Tabla de visitas %>
<div class="card shadow-sm">
  <div class="card-body">
    <% if @visits.any? %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Promotor</th>
              <th>Tienda</th>
              <th>Cadena</th>
              <th>Formato</th>
              <th>Estado</th>
              <th class="text-end">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <% @visits.each do |visit| %>
              <tr>
                <td>
                  <strong><%= visit.scheduled_date.strftime("%d/%m/%Y") %></strong>
                  <br>
                  <small class="text-muted"><%= visit.scheduled_date.strftime("%A") %></small>
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="avatar-circle bg-primary me-2 avatar-with-icon" style="width: 32px; height: 32px;">
                      <%= image_tag 'user-avatar.svg', alt: 'Usuario', class: 'avatar-icon', style: 'width: 100%; height: 100%; object-fit: cover;' %>
                    </div>
                    <%= visit.user.name %>
                  </div>
                </td>
                <td><%= visit.store.name %></td>
                <td><%= visit.store.chain.name %></td>
                <td><%= visit.store.format.name %></td>
                <td>
                  <% case visit.status %>
                  <% when 'scheduled' %>
                    <span class="badge bg-info">Programada</span>
                  <% when 'in_progress' %>
                    <span class="badge bg-warning">En Curso</span>
                  <% when 'completed' %>
                    <span class="badge bg-success">Completada</span>
                  <% when 'cancelled' %>
                    <span class="badge bg-secondary">Cancelada</span>
                  <% end %>
                </td>
                <td class="text-end">
                  <%= link_to edit_visit_path(visit), class: "btn btn-sm btn-outline-primary me-2" do %>
                    <i class="bi bi-pencil"></i> Editar
                  <% end %>
                  <%= link_to visit_path(visit), method: :delete, 
                      data: { confirm: "¿Estás seguro de eliminar esta visita?" },
                      class: "btn btn-sm btn-outline-danger" do %>
                    <i class="bi bi-trash"></i> Eliminar
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <%= render 'shared/empty_state',
          icon: "bi-calendar-check",
          message: "No hay visitas programadas aún." %>
    <% end %>
  </div>
</div>
