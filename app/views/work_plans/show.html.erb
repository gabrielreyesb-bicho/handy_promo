<%# Barra de información / navegación (componente reutilizable) %>
<%= render 'shared/view_header', title: @work_plan.name do %>
  <%= link_to edit_work_plan_path(@work_plan), class: "btn btn-primary" do %>
    <i class="bi bi-pencil me-2"></i> Editar
  <% end %>
  <%= link_to work_plans_path, class: "btn btn-secondary" do %>
    <i class="bi bi-arrow-left me-2"></i> Volver
  <% end %>
<% end %>

<%# Espacio vacío (componente reutilizable) %>
<div class="view-spacing"></div>

<%# Detalles del plan de trabajo %>
<div class="row justify-content-center">
  <div class="col-12 col-lg-10">
    <%# Información del Plan %>
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-success text-white">
        <h5 class="mb-0"><i class="bi bi-clipboard-check me-2"></i>Información del Plan de Trabajo</h5>
      </div>
      <div class="card-body p-4">
        <div class="row mb-3">
          <div class="col-md-6">
            <strong>Código:</strong><br>
            <code class="text-success"><%= @work_plan.code %></code>
          </div>
          <div class="col-md-6">
            <strong>Estado:</strong><br>
            <% if @work_plan.active? %>
              <span class="badge bg-success">Activo</span>
            <% else %>
              <span class="badge bg-secondary">Inactivo</span>
            <% end %>
          </div>
        </div>
        
        <div class="mb-3">
          <strong>Nombre:</strong><br>
          <h5 class="mt-2"><%= @work_plan.name %></h5>
        </div>
        
        <% if @work_plan.description.present? %>
          <div class="mb-3">
            <strong>Descripción:</strong><br>
            <p class="mt-2"><%= @work_plan.description %></p>
          </div>
        <% end %>
      </div>
    </div>
    
    <%# Tareas del Plan %>
    <div class="card shadow-sm">
      <div class="card-header bg-info text-white">
        <h5 class="mb-0">
          <i class="bi bi-list-task me-2"></i>Tareas del Plan (<%= @work_plan_tasks.count %>)
        </h5>
      </div>
      <div class="card-body p-4">
        <% if @work_plan_tasks.any? %>
          <div class="list-group">
            <% @work_plan_tasks.each_with_index do |work_plan_task, index| %>
              <div class="list-group-item">
                <div class="d-flex align-items-start">
                  <div class="me-3">
                    <span class="badge bg-primary rounded-pill"><%= index + 1 %></span>
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="mb-1"><%= work_plan_task.task.name %></h6>
                    <small class="text-muted">
                      <code><%= work_plan_task.task.code %></code> | 
                      <span class="badge bg-secondary"><%= work_plan_task.task.task_type.humanize %></span>
                    </small>
                    <% if work_plan_task.task.description.present? %>
                      <p class="mb-1 mt-2"><%= work_plan_task.task.description %></p>
                    <% end %>
                    <% if work_plan_task.instructions.present? %>
                      <div class="alert alert-light mt-2 mb-0">
                        <strong>Instrucciones específicas:</strong><br>
                        <%= work_plan_task.instructions %>
                      </div>
                    <% end %>
                    <% if work_plan_task.task.image_display? && work_plan_task.image.attached? %>
                      <div class="mt-3">
                        <strong>Imagen configurada:</strong>
                        <div class="mt-2">
                          <%= image_tag work_plan_task.image, class: "img-thumbnail", style: "max-width: 300px; max-height: 300px; cursor: pointer;", onclick: "window.open(this.src, '_blank')" %>
                          <p class="text-muted small mt-2 mb-0">
                            <i class="bi bi-info-circle me-1"></i>
                            Haz clic en la imagen para verla en tamaño completo
                          </p>
                        </div>
                      </div>
                    <% elsif work_plan_task.task.image_display? && !work_plan_task.image.attached? %>
                      <div class="alert alert-warning mt-2 mb-0">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Advertencia:</strong> Esta tarea requiere una imagen pero no se ha configurado ninguna.
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center text-muted py-5">
            <i class="bi bi-inbox fs-1 d-block mb-2"></i>
            <p>Este plan no tiene tareas asignadas aún.</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
